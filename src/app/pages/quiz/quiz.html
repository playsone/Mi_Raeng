<div
  class="container vh-100 d-flex flex-column justify-content-center align-items-center"
>
  <div class="col-12 col-md-8 col-lg-6 col-xl-5 text-center">
    <h1 class="display-6 mb-4">แบบประเมินความพร้อม<br />ในการออกกำลังกาย</h1>

    <!-- Quiz Card -->
    @if (!isQuizFinished) {
    <div class="card shadow p-4 p-md-5">
      <div class="card-body">
        <!-- MODIFIED: Question display with a speaker button -->
        <div class="d-flex align-items-start justify-content-center mb-5 gap-3">
          <p class="fs-5 m-0 text-center flex-grow-1">{{ currentQuestion }}</p>
          <button
            class="btn btn-outline-secondary rounded-circle p-2 flex-shrink-0"
            (click)="speak(currentQuestion)"
            title="อ่านออกเสียง"
            aria-label="Read question aloud"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path
                d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"
              ></path>
            </svg>
          </button>
        </div>

        <div class="row justify-content-around">
          <div class="col-5">
            <label class="option-label green">
              <input
                type="radio"
                name="answer-{{ currentIndex }}"
                [(ngModel)]="answers[currentIndex]"
                value="yes"
              />
              <span class="custom-checkbox"></span>
              ใช่
            </label>
          </div>
          <div class="col-5">
            <label class="option-label red">
              <input
                type="radio"
                name="answer-{{ currentIndex }}"
                [(ngModel)]="answers[currentIndex]"
                value="no"
              />
              <span class="custom-checkbox"></span>
              ไม่ใช่
            </label>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Result Card -->
    @if (isQuizFinished) {
    <div class="card shadow-lg p-4 p-md-5 finished-card">
      <!-- Case 1: User passed (all 'no') -->
      @if (quizResult === 'passed') {
      <div class="icon-container">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="100"
          height="100"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="success"
        >
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
      </div>
      <h2 class="mt-4">ยอดเยี่ยม!</h2>
      <p class="fs-5 text-muted">
        คุณพร้อมสำหรับการออกกำลังกาย... กำลังนำคุณไปสู่หน้าถัดไป
      </p>
      } @if (quizResult === 'failed') {
      <div class="icon-container">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="100"
          height="100"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="failed"
        >
          <path
            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
          ></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <h2 class="mt-4">เสียใจด้วย</h2>
      <p class="fs-5 text-muted px-3">
        สุขภาพของคุณยังไม่พร้อมสำหรับการใช้งานเเอพพลิเคชั่นไว้กลับมาใหม่เร็วๆนี้นะคะ
      </p>
      <button class="btn btn-primary mt-4" (click)="restartQuiz()">
        ทำแบบประเมินอีกครั้ง
      </button>
      }
    </div>
    }

    <!-- Navigation Buttons -->
    @if (!isQuizFinished) {
    <div class="d-flex justify-content-center gap-3 mt-4">
      @if (currentIndex > 0) {
      <button class="btn btn-light btn-lg shadow-sm px-5" (click)="onBack()">
        ย้อนกลับ
      </button>
      }
      <button
        class="btn btn-light btn-lg shadow-sm px-5"
        (click)="onNext()"
        [disabled]="!answers[currentIndex]"
      >
        ถัดไป
      </button>
    </div>
    }
  </div>
</div>
